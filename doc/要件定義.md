# Dream-gpt 開発設計書

# 要件定義

1. 目標から自動で計画立案
2. Todo 表にして進捗率を管理
3. カレンダーに Todo の期間を表示してスケジュール感をつかむ
4. ログイン、サインイン機能
5. ユーザー設定機能

# 画面設計

1. トップページ（LP）
2. ダッシュボード画面　 SAP で開発
3. 目標作成画面
4. Todo 画面
5. カレンダー画面
6. ユーザー設定画面
7. サインイン画面
8. ログイン画面

## 1. トップページ（LP）

ここは適当でいい

## 2. ダッシュボード画面

1. navber
2. sidebar

## 3. 目標作成画面

1. 目標
2. 期間
   1. 数字　 input で数字だけ入力されるようにバリデーション
   2. 単位（月、年）プルダウンメニューで選択
3. 備考（使用する教材などの指定）

## 4. Todo 画面

1. ユーザーごとの目標一覧をプルダウンで選択
2. 計画を月、または年ごとに分ける。(ユーザーの目標作成時の選択によって変わる。)
3. Todo カードとして作成、達成率などを表示したい。
4. 目標の削除機能

# データベース設計

### 初期案

```mermaid
erDiagram

 USERS {
        string user_id PK "ユーザーID (UUID)"
        string email "メールアドレス"
        string name "ユーザー名"

        datetime created_at "作成日時"
    }

    GOALS {
        string goal_id PK "目標ID (UUID)"
        string user_id FK "ユーザーID"
        string title "目標タイトル"
        text description "目標の説明"
        string category "カテゴリ"
        date due_date "達成期日"
        datetime created_at "作成日時"
    }

    PLANS {
        string plan_id PK "計画ID (UUID)"
        string goal_id FK "目標ID"
        string parent_plan_id FK "親計画ID (自己参照)"
        string title "計画タイトル (例: 1ヶ月目)"
        integer sort_order "表示順"
        datetime created_at "作成日時"
    }

    TASKS {
        string task_id PK "タスクID (UUID)"
        string plan_id FK "計画ID"
        text text "タスク内容"
        boolean is_completed "完了フラグ"
        integer sort_order "表示順"
        datetime created_at "作成日時"
    }

    USERS ||--o{ GOALS : "has"
    GOALS ||--o{ PLANS : "contains"
    PLANS ||--o{ PLANS : "has sub-plan"
    PLANS ||--o{ TASKS : "contains"
```

### 改善案

```mermaid

erDiagram

USERS {
    string user_id PK "ユーザーID"
    string user_name "名前"
    string email "メールアドレス"
    datetime created_at "作成日時"
}

GOALS {
        string plan_id PK "目標ID (UUID)"
        string user_id FK "ユーザーID"
        string title "計画タイトル"
        string MonthORYear "月か週か"
        datetime created_at "作成日時"
    }

PLANS {
    string plan_id FK "目標ID (UUID)"
    UUID unique_id PK "ユニークキー"
    int periodNum "月・週番号（ソート用）"
    int id "タスクごとのID（ソート用）"
    string title "タスクの内容"
    string deadline "達成時期"
    bool isDone "やったかどうか"

}
 USERS ||--o{ GOALS : "一人のユーザーは複数の目標を持つ"
 GOALS ||--o{ PLANS : "一つの目標は複数の計画を持つ"

```
### sql
```sql

-- ① Users テーブル作成（まだ作っていない場合）
CREATE TABLE IF NOT EXISTS public."Users" (
  "userId" uuid PRIMARY KEY,
  name text DEFAULT 'GUEST',
  "createdAt" timestamp with time zone DEFAULT now()
);

-- ② トリガー関数作成
CREATE OR REPLACE FUNCTION public.handle_new_user()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO public."Users" ("userId", name, "createdAt")
  VALUES (NEW.id, 'GUEST', now());
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- ③ トリガー作成
CREATE TRIGGER on_auth_user_created
AFTER INSERT ON auth.users
FOR EACH ROW
EXECUTE FUNCTION public.handle_new_user();


```

## AI から期待されるデータ構造

```javascript


   {
    monthOrYear: month,
    plan:
        [1:{
           title: 一章を勉強する, deadline: 2025-11-01,
           title: 一章を勉強する, deadline: 2025-11-01,
           title: 一章を勉強する, deadline: 2025-11-01,
           title: 一章を勉強する, deadline: 2025-11-01,
       },
       2:{
           title: 一章を勉強する, deadline: 2025-11-01,
           title: 一章を勉強する, deadline: 2025-11-01,
           title: 一章を勉強する, deadline: 2025-11-01,
           title: 一章を勉強する, deadline: 2025-11-01,
       }]


   }


```
